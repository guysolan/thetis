---
import Social from "@/components/icons/socials/Social";
import Slide from "@/components/Slide.astro";
import FooterEmailCTA from "@/components/CTA/FooterEmailCTA.astro";
import FooterBlock from "./FooterBlock.astro";
import { ThemeToggle } from "../../components/theme/ThemeToggle";
import {
  getRoutesByLanguage,
  productRoutes,
  partnerRoutes,
  contactRoutes,
} from "../../content/routes.tsx";
import type { Lang } from "../../config/languages.ts";

export interface Props {
  lang?: Lang;
}

const { lang = "en" } = Astro.props as Props;

const localizedRoutes = getRoutesByLanguage(lang);

// Filter routes by category
const productLinks = localizedRoutes.filter((route) => {
  // Find the base route that matches this translated route
  const baseRoute = productRoutes.find(
    (pr) =>
      pr.slugTranslations?.[lang] === route.slug || pr.slug === route.slug,
  );
  return !!baseRoute;
});

const partnerLinks = localizedRoutes.filter((route) => {
  // Find the base route that matches this translated route
  const baseRoute = partnerRoutes.find(
    (pr) =>
      pr.slugTranslations?.[lang] === route.slug || pr.slug === route.slug,
  );
  return !!baseRoute;
});

const contactLinks = localizedRoutes.filter((route) => {
  // Find the base route that matches this translated route
  const baseRoute = contactRoutes.find(
    (cr) =>
      cr.slugTranslations?.[lang] === route.slug || cr.slug === route.slug,
  );
  return !!baseRoute;
});

const faqLinks = localizedRoutes.filter((route) =>
  route.slug.startsWith("FAQs/"),
);

// Get section titles from routes.tsx content
const getSectionTitle = (routes: any[], sectionSlug: string) => {
  const route = routes.find((r) => r.slug === sectionSlug);
  return route?.title?.[lang] || route?.title?.en || sectionSlug;
};

const footerLinks = {
  company: {
    title: getSectionTitle(contactRoutes, "contact"),
    links: contactLinks,
  },
  products: {
    title: getSectionTitle(productRoutes, "achilles-rupture-splint"),
    links: productLinks,
  },
  patientGuides: {
    title: "Patient Guides", // This is a generic title, not from a specific route
    links: faqLinks,
  },
  professionals: {
    title: getSectionTitle(partnerRoutes, "professionals"),
    links: partnerLinks,
  },
};

// Get "Stay in Touch" title based on language
const stayInTouchTitles = {
  en: "Stay in Touch",
  de: "In Kontakt bleiben",
  fr: "Restez en Contact",
  es: "Mant√©ngase en Contacto",
  it: "Rimani in Contatto",
};

const socials: Array<{
  mode: "mail" | "linkedin" | "instagram" | "facebook";
  color: string;
}> = [
  { mode: "mail", color: "white" },
  { mode: "linkedin", color: "white" },
  { mode: "instagram", color: "white" },
  { mode: "facebook", color: "white" },
];
---

<Slide background="black" className="print:hidden mt-24">
  <footer class="w-full text-white">
    <div
      class="gap-8 lg:gap-12 grid grid-cols-1 lg:grid-cols-3 lg:text-left text-center"
    >
      <!-- Company & Products -->
      <div class="space-y-8">
        <FooterBlock
          title={footerLinks.company.title}
          links={footerLinks.company.links}
        />
        <FooterBlock
          title={footerLinks.products.title}
          links={footerLinks.products.links}
        />
      </div>

      <!-- Patient Guides -->
      <div>
        <FooterBlock
          title={footerLinks.patientGuides.title}
          links={footerLinks.patientGuides.links}
        />
      </div>

      <!-- Partners & Contact -->
      <div class="space-y-8">
        <FooterBlock
          title={footerLinks.professionals.title}
          links={footerLinks.professionals.links}
        />

        <div class="space-y-4">
          <h3 class="font-semibold text-lg">{stayInTouchTitles[lang]}</h3>
          <FooterEmailCTA />

          <div class="flex flex-col items-center lg:items-start gap-y-4">
            <div class="flex justify-center lg:justify-start gap-4">
              {
                socials.map((social) => (
                  <Social color="white" mode={social.mode} />
                ))
              }
            </div>
            <a
              href="mailto:info@thetismedical.com"
              class="font-semibold text-white hover:text-gray-300 text-base transition-colors"
            >
              info@thetismedical.com
            </a>
          </div>
        </div>
      </div>
    </div>

    <div
      class="flex md:flex-row flex-col justify-center md:justify-between items-center mt-8 pt-6 border-gray-800 border-t"
    >
      <p class="text-gray-300 text-base">&copy; Thetis Medical Ltd 2020-2025</p>
    </div>

    <div class="sr-only">
      <ThemeToggle />
    </div>
  </footer>
</Slide>
