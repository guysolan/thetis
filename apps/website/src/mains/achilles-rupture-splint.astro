---
import Layout from "@/layouts/Layout.astro";
import Slide from "@/components/Slide.astro";
import NightSplintSchema from "@/schemas/NightSplintSchema.astro";
import SizeChart from "@/components/SizeChart.jsx";
import NightSplintFAQs from "@/sections/achilles-rupture-splint/SplintFAQs.tsx";
import NightSplintUsage from "@/sections/achilles-rupture-splint/NightSplintUsage.astro";
import NightSplintInstructions from "@/sections/achilles-rupture-splint/night-splint-instructions/index.astro";
import NightSplintHero from "@/sections/achilles-rupture-splint/NightSplintHero.astro";
import ValuePropositions from "@/sections/achilles-rupture-splint/ValuePropositions.astro";
import KeyFeatures from "@/sections/achilles-rupture-splint/KeyFeatures.astro";
import Reviews from "@/components/reviews/InfiniteReviews.astro";
import OrderYourSplint from "@/sections/achilles-rupture-splint/OrderYourSplint.astro";
import SplintDownloads from "@/sections/achilles-rupture-splint/SplintDownloads.astro";
import StickyAddToCart from "@/components/StickyAddToCart.tsx";
import ExitIntentPopup from "@/components/ExitIntentPopup.tsx";
import Breadcrumb from "@/components/Breadcrumb.astro";
import SurgeonsCarousel from "@/components/SurgeonsCarousel";
import { athletes } from "@/components/reviews/content/athletes";
import { translatedClinicians } from "@/components/reviews/content/professional-opinions";
import { Image as AstroImage } from "astro:assets";
import { Trophy, Stethoscope } from "lucide-react";
import { ReviewCard } from "@/components/reviews/ReviewCard.tsx";
import type { Lang } from "@/config/languages.ts";

const { lang = "en" } = Astro.props as { lang?: Lang };

const content = {
    en: {
        title: "Achilles Tendon Rupture Splint",
        description:
            "Thetis Medical's Achilles rupture splint to make sleeping more pleasant and bearable. The brace straps to the leg to prevent further tendon injury.",
        image: "https://thetismedical.com/images/night_splint_bed_top_square.jpg",
    },
    fr: {
        title: "Attelle de Rupture du Tendon d'Achille",
        description:
            "L'attelle de rupture d'Achille de Thetis Medical pour rendre le sommeil plus agréable et supportable. L'orthèse se fixe à la jambe pour prévenir d'autres blessures du tendon.",
        image: "https://thetismedical.com/images/night_splint_bed_top_square.jpg",
    },
    de: {
        title: "Achillessehnenriss-Schiene",
        description:
            "Die Achillessehnenriss-Schiene von Thetis Medical macht das Schlafen angenehmer und erträglicher. Die Orthese wird am Bein befestigt, um weitere Sehnenverletzungen zu verhindern.",
        image: "https://thetismedical.com/images/night_splint_bed_top_square.jpg",
    },
    es: {
        title: "Férula de Rotura del Tendón de Aquiles",
        description:
            "La férula de rotura de Aquiles de Thetis Medical para hacer el sueño más agradable y soportable. La ortesis se sujeta a la pierna para prevenir más lesiones del tendón.",
        image: "https://thetismedical.com/images/night_splint_bed_top_square.jpg",
    },
    it: {
        title: "Férula per Rottura di Achille",
        description:
            "La férula per rottura di Achille di Thetis Medical per rendere il sonno più piacevole e supportabile. L'ortesi si fissa alla gamba per prevenire ulteriori lesioni del tendine.",
        image: "https://thetismedical.com/images/night_splint_bed_top_square.jpg",
    },
};

const currentContent = content[lang as keyof typeof content];
---

<Fragment slot="head">
    <NightSplintSchema />
    <slot name="head" />
</Fragment>

<Layout
    title={currentContent.title}
    description={currentContent.description}
    image={currentContent.image}
    lang={lang}
>
    <main>
        <div class="mx-auto px-4 pt-4 max-w-7xl">
            <Breadcrumb
                items={[
                    { label: "Products", href: "/products-for-torn-achilles" },
                    { label: "Night Splint" },
                ]}
            />
        </div>
        <NightSplintHero lang={lang} />

        <!-- Social Proof - Reviews -->
        <section class="bg-white py-16 md:py-20">
            <div class="mx-auto px-4 max-w-7xl">
                <div class="mb-12 text-center">
                    <h2
                        class="mb-4 font-bold text-neutral-900 text-3xl md:text-4xl"
                    >
                        Join 5,000+ Patients Who've Found Relief
                    </h2>
                    <p class="mb-6 text-neutral-600 text-lg">
                        Real reviews from real patients recovering from Achilles
                        rupture
                    </p>
                </div>
                <div class="mb-8">
                    <Reviews />
                </div>
            </div>
        </section>

        <!-- Who This Is For Section -->
        <section class="bg-neutral-50 py-16 md:py-20">
            <div class="mx-auto px-4 max-w-4xl">
                <div class="mb-12 text-center">
                    <h2
                        class="mb-4 font-bold text-neutral-900 text-3xl md:text-4xl"
                    >
                        Who This Is For
                    </h2>
                    <p class="text-neutral-600 text-lg">
                        The Thetis Night Splint is specifically designed for
                        Achilles tendon rupture recovery
                    </p>
                </div>
                <div class="gap-6 grid md:grid-cols-2">
                    <div
                        class="bg-primary/5 p-6 border-2 border-primary/30 rounded-lg"
                    >
                        <h3
                            class="flex items-center gap-2 mb-4 font-bold text-primary text-xl"
                        >
                            <span class="text-2xl">✓</span>
                            Perfect For:
                        </h3>
                        <ul class="space-y-2 text-primary">
                            <li class="flex items-start gap-2">
                                <span class="mt-1 text-primary">•</span>
                                <span
                                    >Achilles tendon rupture (complete tear)</span
                                >
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="mt-1 text-primary">•</span>
                                <span>Within 12 weeks of injury or surgery</span
                                >
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="mt-1 text-primary">•</span>
                                <span
                                    >Approved by your surgeon for night use</span
                                >
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="mt-1 text-primary">•</span>
                                <span
                                    >Struggling to sleep in your walking boot</span
                                >
                            </li>
                        </ul>
                    </div>
                    <div
                        class="bg-red-50 p-6 border-2 border-red-200 rounded-lg"
                    >
                        <h3
                            class="flex items-center gap-2 mb-4 font-bold text-red-900 text-xl"
                        >
                            <span class="text-2xl">✗</span>
                            Not For:
                        </h3>
                        <ul class="space-y-2 text-red-800">
                            <li class="flex items-start gap-2">
                                <span class="mt-1 text-red-600">•</span>
                                <span>Achilles tendinitis or tendinopathy</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="mt-1 text-red-600">•</span>
                                <span>More than 12 weeks post-injury</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="mt-1 text-red-600">•</span>
                                <span>Other foot or ankle conditions</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="mt-1 text-red-600">•</span>
                                <span>Not approved by your medical team</span>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="mt-8 text-center">
                    <p class="text-neutral-600">
                        <strong>Always check with your surgeon first.</strong> This
                        splint is specifically designed for Achilles rupture recovery
                        and may not be suitable for other conditions.
                    </p>
                </div>
            </div>
        </section>

        <!-- Comparison Table: Night Splint vs Boot -->
        <section class="bg-white py-16 md:py-20 border-neutral-200 border-y">
            <div class="mx-auto px-4 max-w-5xl">
                <div class="mb-12 text-center">
                    <h2
                        class="mb-4 font-bold text-neutral-900 text-3xl md:text-4xl"
                    >
                        Night Splint vs Boot: Side-by-Side Comparison
                    </h2>
                    <p class="text-neutral-600 text-lg">
                        Both provide protection. Only one lets you sleep
                        comfortably.
                    </p>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr
                                class="bg-neutral-50 border-neutral-200 border-b-2"
                            >
                                <th
                                    class="p-4 font-semibold text-neutral-900 text-left"
                                >
                                    Feature
                                </th>
                                <th
                                    class="p-4 font-semibold text-red-900 text-center"
                                >
                                    Boot
                                </th>
                                <th
                                    class="p-4 font-semibold text-primary text-center"
                                >
                                    Thetis Night Splint
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-neutral-200 border-b">
                                <td class="p-4 font-medium text-neutral-900">
                                    Weight
                                </td>
                                <td class="p-4 text-red-800 text-center">
                                    1.5kg+
                                </td>
                                <td
                                    class="p-4 font-semibold text-primary text-center"
                                >
                                    200g (90% lighter)
                                </td>
                            </tr>
                            <tr
                                class="bg-neutral-50/50 border-neutral-200 border-b"
                            >
                                <td class="p-4 font-medium text-neutral-900">
                                    Breathability
                                </td>
                                <td class="p-4 text-red-800 text-center">
                                    Enclosed, traps heat
                                </td>
                                <td
                                    class="p-4 font-semibold text-primary text-center"
                                >
                                    Open design (exposes sole of foot and back
                                    of leg)
                                </td>
                            </tr>
                            <tr class="border-neutral-200 border-b">
                                <td class="p-4 font-medium text-neutral-900">
                                    Cleanliness
                                </td>
                                <td class="p-4 text-red-800 text-center">
                                    Dirt and debris in bed
                                </td>
                                <td
                                    class="p-4 font-semibold text-primary text-center"
                                >
                                    Clean (no dirt in bed)
                                </td>
                            </tr>
                            <tr
                                class="bg-neutral-50/50 border-neutral-200 border-b"
                            >
                                <td class="p-4 font-medium text-neutral-900">
                                    Showering
                                </td>
                                <td class="p-4 text-red-800 text-center">
                                    Cannot shower in it
                                </td>
                                <td
                                    class="p-4 font-semibold text-primary text-center"
                                >
                                    Can shower in it
                                </td>
                            </tr>
                            <tr class="border-neutral-200 border-b">
                                <td class="p-4 font-medium text-neutral-900">
                                    Use Period
                                </td>
                                <td class="p-4 text-neutral-700 text-center">
                                    Weeks 0-12
                                </td>
                                <td class="p-4 text-neutral-700 text-center">
                                    Weeks 0-12
                                </td>
                            </tr>
                            <tr
                                class="bg-primary/5 border-neutral-300 border-b-2"
                            >
                                <td class="p-4 font-medium text-neutral-900">
                                    Healing Angle
                                </td>
                                <td class="p-4 text-neutral-700 text-center">
                                    30° plantarflexion
                                </td>
                                <td class="p-4 text-neutral-700 text-center">
                                    30° plantarflexion
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="mt-8 text-center">
                    <p class="text-neutral-600 text-sm">
                        Both provide the same protection at the correct 30°
                        healing angle. The splint is simply lighter, more
                        breathable, and cleaner for sleeping.
                    </p>
                </div>
            </div>
        </section>

        <!-- Athlete Endorsements -->
        <section
            class="bg-gradient-to-b from-white to-primary/5 py-16 md:py-24"
        >
            <div class="mx-auto px-4 max-w-7xl">
                <div class="mb-12 text-center">
                    <div
                        class="inline-flex items-center gap-2 bg-primary/10 mb-4 px-4 py-2 rounded-full"
                    >
                        <Trophy className="w-5 h-5 text-primary" />
                        <p
                            class="font-medium text-primary text-sm uppercase tracking-widest"
                        >
                            TRUSTED BY ELITE ATHLETES
                        </p>
                    </div>
                    <h2
                        class="mb-4 font-bold text-neutral-900 text-3xl md:text-4xl"
                    >
                        Trusted by <span class="text-primary"
                            >Professional Athletes</span
                        >
                    </h2>
                    <p class="mx-auto max-w-2xl text-neutral-600 text-lg">
                        Elite athletes choose Thetis Night Splint for their
                        recovery. Lightweight, comfortable, and trusted by Team
                        GB athletes.
                    </p>
                </div>

                <!-- All Athlete Reviews -->
                <div class="masonry-grid">
                    {
                        athletes.map((athlete) => {
                            const athleteReview = {
                                ...athlete,
                                type: "athlete" as const,
                                link: "",
                                clinics: [],
                                clinicImages: [],
                                date: athlete.date || "2024-01-01",
                            };
                            return (
                                <div class="masonry-item">
                                    <ReviewCard
                                        review={athleteReview}
                                        client:load
                                    />
                                </div>
                            );
                        })
                    }
                </div>
            </div>
        </section>

        <style>
            .masonry-grid {
                columns: 1;
                column-gap: 1.5rem;
                width: 100%;
            }

            .masonry-grid > div {
                margin-bottom: 1.5rem;
                break-inside: avoid;
            }

            @media (min-width: 750px) {
                .masonry-grid {
                    columns: 2;
                }
            }

            @media (min-width: 900px) {
                .masonry-grid {
                    columns: 3;
                }
            }
        </style>

        <!-- Surgeon Endorsements -->
        <section
            class="bg-gradient-to-b from-primary/5 to-white py-16 md:py-24"
        >
            <div class="mx-auto px-4 max-w-7xl">
                <div class="mb-12 text-center">
                    <div
                        class="inline-flex items-center gap-2 bg-primary/10 mb-4 px-4 py-2 rounded-full"
                    >
                        <Stethoscope className="w-5 h-5 text-primary" />
                        <p
                            class="font-medium text-primary text-sm uppercase tracking-widest"
                        >
                            PROFESSIONAL ENDORSEMENTS
                        </p>
                    </div>
                    <h2
                        class="mb-4 font-bold text-neutral-900 text-3xl md:text-4xl"
                    >
                        Trusted by <span class="text-primary"
                            >Leading Surgeons</span
                        >
                    </h2>
                    <p class="mx-auto max-w-2xl text-neutral-600 text-lg">
                        Healthcare professionals worldwide recommend Thetis
                        Night Splint for safe, effective Achilles rupture
                        recovery.
                    </p>
                </div>

                <!-- All Clinician Reviews -->
                <div class="masonry-grid">
                    {
                        translatedClinicians.map((clinician) => {
                            const content =
                                clinician.content[lang] || clinician.content.en;
                            const clinicianReview = {
                                name: clinician.name,
                                description: content.description,
                                title: content.title,
                                body: content.body,
                                image: clinician.image,
                                type: "clinician" as const,
                                link: "",
                                clinics: clinician.clinics || [],
                                clinicImages: clinician.clinicImages || [],
                                date: clinician.date || "2024-01-01",
                                country: clinician.country,
                                stars: 5,
                                is_pinned: false,
                            };
                            return (
                                <div class="masonry-item">
                                    <ReviewCard
                                        review={clinicianReview}
                                        client:load
                                    />
                                </div>
                            );
                        })
                    }
                </div>
            </div>
        </section>

        <ValuePropositions lang={lang} />

        <KeyFeatures lang={lang} />

        <!-- Lazy load YouTube iframe -->
        <div class="relative mx-auto mt-8 w-full">
            <div
                id="youtube-placeholder"
                class="flex justify-center items-center bg-gray-200 shadow-lg mx-auto rounded-lg w-full max-w-[300px] md:max-w-[50vw] lg:max-w-[70vw] aspect-video cursor-pointer"
                data-youtube-id="T09Xnwaqbm0"
            >
                <div class="text-center">
                    <div class="mb-2 text-4xl">▶️</div>
                    <p class="text-gray-600 text-sm">Click to load video</p>
                </div>
            </div>
        </div>

        <NightSplintUsage lang={lang} />

        <NightSplintInstructions lang={lang} />

        <NightSplintFAQs client:load lang={lang} />

        <OrderYourSplint lang={lang} />

        <SplintDownloads lang={lang} />

        <!-- Sticky Add to Cart -->
        <StickyAddToCart lang={lang} client:load />

        <!-- Exit Intent Popup -->
        <ExitIntentPopup client:load />
    </main>

    <script>
        // Lazy load YouTube iframe when user clicks on placeholder
        document.addEventListener("DOMContentLoaded", () => {
            const placeholder = document.getElementById("youtube-placeholder");
            if (placeholder) {
                placeholder.addEventListener("click", () => {
                    const youtubeId =
                        placeholder.getAttribute("data-youtube-id");
                    const iframe = document.createElement("iframe");
                    iframe.className =
                        "shadow-lg mx-auto rounded-lg w-full max-w-[300px] md:hover:max-w-[60vw] md:max-w-[50vw] lg:hover:max-w-[70vw] hover:max-w-[80vw] aspect-video transition-all duration-300 cursor-pointer";
                    iframe.title = "Night-Splint-Application";
                    iframe.src = `https://www.youtube.com/embed/${youtubeId}`;
                    iframe.allow =
                        "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
                    iframe.allowFullscreen = true;

                    placeholder.parentNode?.replaceChild(iframe, placeholder);
                });
            }
        });
    </script>

    <style>
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
        }
    </style>
</Layout>
