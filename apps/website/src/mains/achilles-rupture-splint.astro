---
import Layout from "@/layouts/Layout.astro";
import Slide from "@/components/Slide.astro";
import NightSplintSchema from "@/schemas/NightSplintSchema.astro";
import SizeChart from "@/components/SizeChart.jsx";
import NightSplintFAQs from "@/sections/achilles-rupture-splint/SplintFAQs.tsx";
import NightSplintUsage from "@/sections/achilles-rupture-splint/NightSplintUsage.astro";
import NightSplintInstructions from "@/sections/achilles-rupture-splint/night-splint-instructions/index.astro";
import NightSplintHero from "@/sections/achilles-rupture-splint/NightSplintHero.astro";
import ValuePropositions from "@/sections/achilles-rupture-splint/ValuePropositions.astro";
import KeyFeatures from "@/sections/achilles-rupture-splint/KeyFeatures.astro";
import Reviews from "@/components/reviews/InfiniteReviews.astro";
import SplintIntro from "@/sections/achilles-rupture-splint/SplintIntro.astro";
import ReadyForRelief from "@/sections/achilles-rupture-splint/ReadyForRelief.astro";
import ComfortableRecoveryReviews from "@/sections/achilles-rupture-splint/ComfortableRecoveryReviews.astro";
import OrderYourSplint from "@/sections/achilles-rupture-splint/OrderYourSplint.astro";
import SleepInYourWelliesSection from "@/sections/achilles-rupture-splint/SleepInYourWelliesSection.astro";
import SplintDownloads from "@/sections/achilles-rupture-splint/SplintDownloads.astro";
import type { Lang } from "@/config/languages.ts";

const { lang = "en" } = Astro.props as { lang?: Lang };

const content = {
    en: {
        title: "Achilles Tendon Rupture Splint",
        description:
            "Thetis Medical's Achilles rupture splint to make sleeping more pleasant and bearable. The brace straps to the leg to prevent further tendon injury.",
        image: "https://thetismedical.com/images/night_splint_bed_top_square.jpg",
    },
    fr: {
        title: "Attelle de Rupture du Tendon d'Achille",
        description:
            "L'attelle de rupture d'Achille de Thetis Medical pour rendre le sommeil plus agréable et supportable. L'orthèse se fixe à la jambe pour prévenir d'autres blessures du tendon.",
        image: "https://thetismedical.com/images/night_splint_bed_top_square.jpg",
    },
    de: {
        title: "Achillessehnenriss-Schiene",
        description:
            "Die Achillessehnenriss-Schiene von Thetis Medical macht das Schlafen angenehmer und erträglicher. Die Orthese wird am Bein befestigt, um weitere Sehnenverletzungen zu verhindern.",
        image: "https://thetismedical.com/images/night_splint_bed_top_square.jpg",
    },
    es: {
        title: "Férula de Rotura del Tendón de Aquiles",
        description:
            "La férula de rotura de Aquiles de Thetis Medical para hacer el sueño más agradable y soportable. La ortesis se sujeta a la pierna para prevenir más lesiones del tendón.",
        image: "https://thetismedical.com/images/night_splint_bed_top_square.jpg",
    },
    it: {
        title: "Férula per Rottura di Achille",
        description:
            "La férula per rottura di Achille di Thetis Medical per rendere il sonno più piacevole e supportabile. L'ortesi si fissa alla gamba per prevenire ulteriori lesioni del tendine.",
        image: "https://thetismedical.com/images/night_splint_bed_top_square.jpg",
    },
};

const currentContent = content[lang as keyof typeof content];
---

<Fragment slot="head">
    <NightSplintSchema />
    <slot name="head" />
</Fragment>

<Layout
    title={currentContent.title}
    description={currentContent.description}
    image={currentContent.image}
    lang={lang}
>
    <main>
        <NightSplintHero lang={lang} />

        <SplintIntro lang={lang} />

        <SleepInYourWelliesSection />

        <Reviews />

        <ValuePropositions lang={lang} />

        <KeyFeatures lang={lang} />

        <ReadyForRelief lang={lang} />

        <ComfortableRecoveryReviews lang={lang} />

        <!-- Lazy load YouTube iframe -->
        <div class="relative mx-auto mt-8 w-full">
            <div
                id="youtube-placeholder"
                class="flex justify-center items-center bg-gray-200 shadow-lg mx-auto rounded-lg w-full max-w-[300px] md:max-w-[50vw] lg:max-w-[70vw] aspect-video cursor-pointer"
                data-youtube-id="T09Xnwaqbm0"
            >
                <div class="text-center">
                    <div class="mb-2 text-4xl">▶️</div>
                    <p class="text-gray-600 text-sm">Click to load video</p>
                </div>
            </div>
        </div>

        <NightSplintUsage lang={lang} />

        <NightSplintInstructions lang={lang} />

        <NightSplintFAQs lang={lang} />

        <OrderYourSplint lang={lang} />

        <SplintDownloads lang={lang} />

        <!-- Load reviews last since they're not critical for initial page load -->
        <Reviews />
    </main>

    <script>
        // Lazy load YouTube iframe when user clicks on placeholder
        document.addEventListener("DOMContentLoaded", () => {
            const placeholder = document.getElementById("youtube-placeholder");
            if (placeholder) {
                placeholder.addEventListener("click", () => {
                    const youtubeId =
                        placeholder.getAttribute("data-youtube-id");
                    const iframe = document.createElement("iframe");
                    iframe.className =
                        "shadow-lg mx-auto rounded-lg w-full max-w-[300px] md:hover:max-w-[60vw] md:max-w-[50vw] lg:hover:max-w-[70vw] hover:max-w-[80vw] aspect-video transition-all duration-300 cursor-pointer";
                    iframe.title = "Night-Splint-Application";
                    iframe.src = `https://www.youtube.com/embed/${youtubeId}`;
                    iframe.allow =
                        "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
                    iframe.allowFullscreen = true;

                    placeholder.parentNode?.replaceChild(iframe, placeholder);
                });
            }
        });
    </script>

    <style>
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
        }
    </style>
</Layout>
