---
import GuideLayout from "@/layouts/GuideLayout.astro";

// Define the phase mapping
const phases = [
    {
        slug: "weeks-0-1",
        file: "week-0-1-first-week-after-achilles-rupture",
        title: "Week 0-1: First Week After Rupture",
        shortTitle: "Week 0-1",
    },
    {
        slug: "weeks-1-3",
        file: "weeks-1-3-treatment-decision",
        title: "Weeks 1-3: Treatment Decision",
        shortTitle: "Weeks 1-3",
    },
    {
        slug: "weeks-4-6",
        file: "weeks-4-6-progressive-recovery",
        title: "Weeks 4-6: Progressive Recovery",
        shortTitle: "Weeks 4-6",
    },
    {
        slug: "weeks-7-9",
        file: "weeks-7-9-final-boot-phase",
        title: "Weeks 7-9: Final Boot Phase",
        shortTitle: "Weeks 7-9",
    },
    {
        slug: "weeks-10-12",
        file: "weeks-10-12-boot-transition",
        title: "Weeks 10-12: Boot Transition",
        shortTitle: "Weeks 10-12",
    },
    {
        slug: "weeks-13-25",
        file: "weeks-13-25-progressive-strengthening",
        title: "Weeks 13-25: Progressive Strengthening",
        shortTitle: "Weeks 13-25",
    },
    {
        slug: "week-26-plus",
        file: "week-26-plus-return-to-sport",
        title: "Week 26+: Return to Sport",
        shortTitle: "Week 26+",
    },
];

export function getStaticPaths() {
    return phases.map((phase) => ({
        params: { slug: phase.slug },
    }));
}

const { slug } = Astro.params;

// Import all markdown files
const articles = import.meta.glob<{
    frontmatter: {
        title: string;
        description: string;
        publishedAt: string;
        updatedAt: string;
        phase: string;
    };
    default: any;
}>("/src/content/articles/recovery-phases/*.md", { eager: true });

// Find the current phase
const currentPhaseIndex = phases.findIndex((p) => p.slug === slug);
const currentPhase = phases[currentPhaseIndex];

if (!currentPhase) {
    return Astro.redirect("/guide");
}

// Get the article content
const articlePath = `/src/content/articles/recovery-phases/${currentPhase.file}.md`;
const article = articles[articlePath];

if (!article) {
    return Astro.redirect("/guide");
}

const { frontmatter, default: Content } = article;
---

<GuideLayout
    title={`${frontmatter.title} | Thetis Medical`}
    description={frontmatter.description}
    lang="en"
    currentPhaseIndex={currentPhaseIndex}
    phases={phases}
>
    <!-- Header -->
    <div class="py-8 md:py-10">
        <div class="mx-auto px-4 max-w-3xl">
            <p class="mb-2 text-neutral-500 dark:text-neutral-400 text-sm">
                Phase {currentPhaseIndex + 1} of {phases.length}
            </p>

            <h1
                class="mb-3 font-semibold text-neutral-900 dark:text-neutral-100 text-2xl md:text-3xl"
            >
                {currentPhase.title}
            </h1>

            <p class="text-neutral-600 dark:text-neutral-400">
                {frontmatter.description}
            </p>
        </div>
    </div>

    <!-- Article Content -->
    <article class="pb-10 md:pb-14">
        <div class="mx-auto px-4 max-w-3xl">
            <div class="article-content">
                <Content />
            </div>
        </div>
    </article>
</GuideLayout>

<style is:global>
    .article-content {
        @apply text-neutral-700 dark:text-neutral-300 leading-relaxed;
    }

    /* Hide the first h1 from markdown as we show it in the header */
    .article-content > h1:first-child {
        @apply hidden;
    }

    /* Also hide the first paragraph if it immediately follows the hidden h1 (often intro text we already show) */
    .article-content > h1:first-child + p {
        @apply hidden;
    }

    .article-content h1 {
        @apply mt-10 mb-4 font-semibold text-neutral-900 dark:text-neutral-100 text-2xl;
    }

    .article-content h2 {
        @apply mt-10 mb-4 font-semibold text-neutral-900 dark:text-neutral-100 text-xl;
    }

    .article-content h3 {
        @apply mt-6 mb-3 font-medium text-neutral-900 dark:text-neutral-100 text-lg;
    }

    .article-content p {
        @apply mb-4;
    }

    .article-content ul,
    .article-content ol {
        @apply mb-4 pl-5;
    }

    .article-content ul {
        @apply list-disc;
    }

    .article-content ol {
        @apply list-decimal;
    }

    .article-content li {
        @apply mb-2;
    }

    .article-content a {
        @apply text-primary hover:underline;
    }

    .article-content strong {
        @apply font-medium text-neutral-900 dark:text-neutral-100;
    }

    .article-content blockquote {
        @apply my-4 pl-4 border-neutral-300 dark:border-neutral-600 border-l-2 text-neutral-600 dark:text-neutral-400 italic;
    }
</style>
