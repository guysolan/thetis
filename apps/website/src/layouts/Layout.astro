---
export interface Props {
  title: string;
  description: string;
  image?: string;
  bodyClass?: string;
  hideFooter?: boolean;
  logoColor?: "black" | "white";
  name?: string;
  lang?: string;
  alternateLanguages?: Array<{
    lang: string;
    url: string;
  }>;
  slug?: string; // Add slug for automatic hreflang generation
}

import { cn } from "../lib/utils";
import { getCurrentLanguage, generateHreflangLinks, getSlugFromPath } from "../utils/language";

// Determine current language and slug from URL if not provided
const currentPath = Astro.url.pathname;
const autoDetectedLang = getCurrentLanguage(currentPath);
const autoDetectedSlug = getSlugFromPath(currentPath);

const {
  title,
  description,
  image,
  bodyClass,
  hideFooter,
  logoColor,
  lang = autoDetectedLang.code,
  alternateLanguages = [],
  slug = autoDetectedSlug,
} = Astro.props;

// Generate hreflang links if slug is available and no manual alternateLanguages provided
const hreflangLinks = (alternateLanguages.length === 0 && slug !== undefined) 
  ? generateHreflangLinks(slug) 
  : alternateLanguages;

import InstantlyPixel from "./InstantlyPixel.astro";
import GoogleTagHead from "./GoogleTagHead.astro";
import GoogleTagBody from "./GoogleTagBody.astro";
import BaseHead from "./BaseHead.astro";
import Nav from "./Nav.astro";
import Footer from "@/features/footer/Footer.astro";
import ShopifyBuyButton2 from "../components/ShopifyBuyButton2.astro";
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <GoogleTagHead />
    <BaseHead
      title={title}
      description={description}
      image={image}
      lang={lang}
      alternateLanguages={hreflangLinks}
    />
    <slot name="head" />
  </head>

  <body class={cn(bodyClass, "pt-10 overflow-y-auto overflow-x-hidden")}>
    <GoogleTagBody />
    <ShopifyBuyButton2 />
    <InstantlyPixel />
    <Nav />
    <slot />
    {!hideFooter && <Footer />}
    <script type="text/partytown" src="@/services/lucide.ts"></script>
    <script type="text/partytown" src="@/services/location"></script>
    <script
      is:inline
      defer
      type="text/partytown"
      src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"
    ></script>

    <script>
      document.documentElement.classList.remove("dark");
    </script>
  </body>
</html>
